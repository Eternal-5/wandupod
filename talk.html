<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>í†¡í†¡, ì½©ì•Œë§ â€“ ì™„ë‘ì½©ê¹ì§€</title>

  <!-- ê¸°ë³¸ ìŠ¤íƒ€ì¼(ë„¤ê°€ ì“°ëŠ” style.css) -->
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase SDK - compat ë²„ì „ -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- Netlify Identity ìœ„ì ¯ -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <!-- ì•„ì£¼ ê°„ë‹¨í•œ ì±„íŒ…ìš© ë‚´ë¶€ ìŠ¤íƒ€ì¼ -->
  <style>
    body          { max-width:900px;margin:0 auto;padding:2rem }
    h1            { text-align:center }
    #chat-list    { list-style:none;padding:0;margin:1.5rem 0;max-height:380px;overflow-y:auto }
    #chat-list li { margin:.4rem 0;padding:.5rem .8rem;background:#e7fbe7;border-radius:8px }
    #sendForm     { display:none;gap:.5rem;margin-top:1rem }
    #sendForm input{ flex:1;padding:.6rem;border-radius:6px;border:1px solid #ccc }
    #sendForm button,
    #loginBtn,
    #logoutBtn    { padding:.6rem 1rem;border:none;border-radius:6px;background:#3b6040;color:#fff;cursor:pointer }
    #logoutBtn    { display:none }
  </style>
</head>
<body>
  <h1>í†¡í†¡, ì½©ì•Œë§</h1>
  <p>ì‹¤ì‹œê°„ìœ¼ë¡œ ì†Œí†µí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. ë¡œê·¸ì¸í•˜ë©´ ë©”ì‹œì§€ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆì–´ìš”!</p>

  <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
  <button id="loginBtn">ğŸ” ë¡œê·¸ì¸</button>
  <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>

  <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
  <ul id="chat-list"></ul>

  <!-- ë©”ì‹œì§€ ì…ë ¥ì°½ -->
  <form id="sendForm">
    <input id="messageInput" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required />
    <button type="submit">ì „ì†¡</button>
  </form>

  <!-- Firebase + Identity + ì±„íŒ… ë¡œì§ -->
  <script>
    /* 1) Firebase ì„¤ì • ê°ì²´ ë¶™ì—¬ë„£ê¸° */
    const firebaseConfig = YOUR_CONFIG_HERE;  /* â† ë³µì‚¬í•œ ì„¤ì • ê°ì²´ë¡œ êµì²´! */

    /* 2) Firebase ì´ˆê¸°í™” */
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    /* 3) Netlify Identity init */
    netlifyIdentity.init();

    /* ìš”ì†Œ ì°¸ì¡° */
    const chatList  = document.getElementById('chat-list');
    const loginBtn  = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const sendForm  = document.getElementById('sendForm');
    const msgInput  = document.getElementById('messageInput');

    let userId = '';   // ë¡œê·¸ì¸ í›„ ì½©ì•Œ ë‹‰ë„¤ì„

    /* 4) ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ë™ì‘ */
    loginBtn.onclick  = () => netlifyIdentity.open('login');
    logoutBtn.onclick = () => netlifyIdentity.logout();

    netlifyIdentity.on('login', user => {
      userId = 'ì½©ì•Œ' + Math.floor(Math.random()*9000 + 1000);   // ì½©ì•Œ1234
      loginBtn.style.display  = 'none';
      logoutBtn.style.display = 'inline';
      sendForm.style.display  = 'flex';
    });

    netlifyIdentity.on('logout', () => location.reload());

    /* 5) ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì¶œë ¥ */
    db.collection('messages').orderBy('timestamp')
      .onSnapshot(snap => {
        chatList.innerHTML = '';
        snap.forEach(doc => {
          const d  = doc.data();
          const li = document.createElement('li');
          li.textContent = `${d.userId} : ${d.message}`;
          chatList.appendChild(li);
        });
        chatList.scrollTop = chatList.scrollHeight;
      });

    /* 6) ë©”ì‹œì§€ ì „ì†¡ */
    sendForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = msgInput.value.trim();
      if(!text) return;
      db.collection('messages').add({
        userId,
        message: text,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      msgInput.value = '';
    });
  </script>
</body>
</html>

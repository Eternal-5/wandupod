<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>í†¡í†¡, ì½©ì•Œë§ â€“ ì™„ë‘ì½©ê¹ì§€</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase SDK (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- Netlify Identity ìœ„ì ¯ -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <style>
    body{max-width:900px;margin:0 auto;padding:2rem}
    h1{text-align:center}
    #chat{list-style:none;padding:0;margin:1.5rem 0;max-height:380px;overflow-y:auto}
    #chat li{margin:.4rem 0;padding:.5rem .8rem;background:#e7fbe7;border-radius:8px}
    #send{display:none;gap:.5rem}
    #send input{flex:1;padding:.6rem;border-radius:6px;border:1px solid #ccc}
    #send button,#login,#logout{padding:.6rem 1rem;border:none;border-radius:6px;background:#3b6040;color:#fff;cursor:pointer}
    #logout{display:none}
  </style>
</head>
<body>
  <h1>í†¡í†¡, ì½©ì•Œë§</h1>
  <p>ì‹¤ì‹œê°„ìœ¼ë¡œ ì†Œí†µí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤. <strong>ë¡œê·¸ì¸í•˜ë©´ ë©”ì‹œì§€ë¥¼ ì‘ì„±</strong>í•  ìˆ˜ ìˆì–´ìš”!</p>

  <!-- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
  <button id="login">ğŸ” ë¡œê·¸ì¸</button>
  <button id="logout">ë¡œê·¸ì•„ì›ƒ</button>

  <!-- ë©”ì‹œì§€ ëª©ë¡ -->
  <ul id="chat"></ul>

  <!-- ë©”ì‹œì§€ ì…ë ¥ -->
  <form id="send">
    <input id="msg" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required />
    <button>ì „ì†¡</button>
  </form>

  <script>

  apiKey: "AIzaSyCpUti20pb1a5qAMvCqWh3FJpn7MDDb8",
  authDomain: "wandupod.firebaseapp.com",
  projectId: "wandupod",
  storageBucket: "wandupod.appspot.com",
  messagingSenderId: "896164102070",
  appId: "1:896164102070:web:6c3a477d1abcbb5c040b17",
  measurementId: "G-VEN0MHF4HR"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  /* â‘¡ Netlify Identity ì´ˆê¸°í™” */
  netlifyIdentity.init();
  const $login  = document.getElementById('login');
  const $logout = document.getElementById('logout');
  const $send   = document.getElementById('send');
  const $chat   = document.getElementById('chat');
  const $msg    = document.getElementById('msg');
  let   nick    = '';          // ì½©ì•Œ ë‹‰ë„¤ì„

  // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
  $login.onclick  = () => netlifyIdentity.open('login');
  $logout.onclick = () => netlifyIdentity.logout();

  // ë¡œê·¸ì¸ í›„ UI í† ê¸€
  netlifyIdentity.on('login', user=>{
    nick = 'ì½©ì•Œ' + Math.floor(Math.random()*9000+1000);
    $login.style.display  = 'none';
    $logout.style.display = 'inline';
    $send.style.display   = 'flex';
    netlifyIdentity.close();
  });
  netlifyIdentity.on('logout', ()=>location.reload());

  /* â‘¢ ì‹¤ì‹œê°„ ë©”ì‹œì§€ í‘œì‹œ */
  db.collection('messages').orderBy('timestamp')
    .onSnapshot(snap=>{
      $chat.innerHTML='';
      snap.forEach(doc=>{
        const d=doc.data();
        const li=document.createElement('li');
        li.textContent=`${d.userId} : ${d.message}`;
        $chat.appendChild(li);
      });
      $chat.scrollTop=$chat.scrollHeight;
    });

  /* â‘£ ë©”ì‹œì§€ ì „ì†¡ */
  $send.addEventListener('submit',e=>{
    e.preventDefault();
    if(!$msg.value.trim()) return;
    db.collection('messages').add({
      userId:nick,
      message:$msg.value.trim(),
      timestamp:firebase.firestore.FieldValue.serverTimestamp()
    });
    $msg.value='';
  });
  </script>
</body>
</html>
